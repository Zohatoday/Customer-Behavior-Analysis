select * from customer limit 20
--Q01. What is the total revenue generated by male vs. female customers?
SELECT "Gender", 
       SUM("Purchase Amount (USD)") AS revenue
FROM customer
GROUP BY "Gender";
--Q02. Which customers used a discount but still spent more than the average purchase amount?
SELECT "Customer ID", 
       "Purchase Amount (USD)"
FROM customer
WHERE "Discount Applied" = 'Yes'
  AND "Purchase Amount (USD)" >= (
      SELECT AVG("Purchase Amount (USD)") 
      FROM customer
  );

--Q03. Which are the top 5 products with the highest average review rating?
SELECT 
    "Item Purchased", 
    ROUND(AVG("Review Rating"::numeric), 2) AS "Average Product Rating"
FROM customer
GROUP BY "Item Purchased"
ORDER BY AVG("Review Rating") DESC
LIMIT 5;

--Q04. Compare the average purchase amount between Standard and Express shipping.
   SELECT 
    "Shipping Type",
    ROUND(AVG("Purchase Amount (USD)"), 2) AS "Average Purchase Amount"
FROM customer
WHERE "Shipping Type" IN ('Standard', 'Express')
GROUP BY "Shipping Type";

--Q05. Do subscribers and subscribed customers spend more? Compare average spend and total revenue between subscribers vs non-subscribers.
SELECT 
    "Subscription Status",
    COUNT("Customer ID") AS total_customers,
    ROUND(AVG("Purchase Amount (USD)"::numeric), 2) AS avg_spend,
    ROUND(SUM("Purchase Amount (USD)"::numeric), 2) AS total_revenue
FROM customer
GROUP BY "Subscription Status"
ORDER BY total_revenue DESC, avg_spend DESC;

--Q06. Which products have the highest percentage of purchases with discounts applied?
SELECT 
    "Item Purchased",
    ROUND(SUM(CASE WHEN "Discount Applied" = 'Yes' THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) AS "Discount Rate"
FROM customer
GROUP BY "Item Purchased"
ORDER BY "Discount Rate" DESC
LIMIT 5;

--Q07. Segment customers into New, Returning, and Loyal based on their total number of previous purchases and show the count of customers in each segment.
WITH customer_type AS (
    SELECT 
        "Customer ID", 
        "Previous Purchases",
        CASE
            WHEN "Previous Purchases" = 1 THEN 'NEW'
            WHEN "Previous Purchases" BETWEEN 2 AND 10 THEN 'Returning'
            ELSE 'Loyal'
        END AS customer_segment
    FROM customer
)
SELECT 
    customer_segment, 
    COUNT(*) AS "Number of Customers"
FROM customer_type
GROUP BY customer_segment;

--Q08. What are the top 3 most purchased products within each category?
WITH item_counts AS (
    SELECT 
        "Category",
        "Item Purchased",
        COUNT("Customer ID") AS total_orders,
        ROW_NUMBER() OVER(
            PARTITION BY "Category"
            ORDER BY COUNT("Customer ID") DESC
        ) AS item_rank
    FROM customer
    GROUP BY "Category", "Item Purchased"
)
SELECT 
    item_rank, 
    "Category", 
    "Item Purchased", 
    total_orders
FROM item_counts
WHERE item_rank <= 3;

--Q09. Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
select "Subscription Status",
COUNT ("Customer ID") as repeat_buyers
from customer
where "Previous Purchases" > 5 
group by "Subscription Status"

--Q10. What is the revenue contribution of each age group?
SELECT 
    "Age",
    SUM("Purchase Amount (USD)") AS total_revenue
FROM customer
GROUP BY "Age"
ORDER BY total_revenue DESC;

--Q10. What is the revenue contribution of each age group?
--wrong
--SELECT 
   -- age_group,
   -- SUM(purchase_amount) AS total_revenue
--FROM customer
--GROUP BY age_group
--ORDER BY total_revenue DESC;